<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Polaroid Personalizado</title>

<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no,
               viewport-fit=cover">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Pacifico&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* === SEU CSS ORIGINAL (INALTERADO) === */
:root{
  --primary: #ff6a00;
  --secondary: #ff9a57;
  --text:#ffffff;
  --card-bg:rgba(255,255,255,.12);
  --border:rgba(255,255,255,.18);
}

*{box-sizing:border-box;font-family:Inter;touch-action:manipulation}
body{margin:0;color:var(--text);background:#000;overflow-x:hidden}

/* ESTRELAS */
/* ===== ESTRELAS ===== */
.stars{
  position:fixed;
  inset:0;
  z-index:0;              /* üî• N√ÉO NEGATIVO */
  pointer-events:none;
}

.star{
  position:absolute;
  width:2px;
  height:2px;
  border-radius:50%;

  background: #ffffff;

  box-shadow:
    0 0 4px #ffffff,
    0 0 10px rgba(255,255,255,.8);

  opacity:.8;
}


@keyframes fall{
  from{
    transform:translateY(-10vh);
  }
  to{
    transform:translateY(110vh);
  }
}


/* LAYOUT */
.page{max-width:1200px;margin:auto;padding:24px 16px 40px}
.layout{display:grid;gap:24px}
@media(min-width:900px){.layout{grid-template-columns:420px 1fr}}

.editor,.galeria{
  background:var(--card-bg);
  backdrop-filter:blur(18px);
  border-radius:28px;
  padding:20px;
  border:1px solid var(--border);
  box-shadow:0 25px 60px rgba(0,0,0,.6);
}

/* POLAROID */
.polaroid{
  width:100%;max-width:300px;height:390px;
  background:rgba(255,255,255,.95);
  border-radius:18px;padding:14px;
  margin:0 auto 18px;position:relative;overflow:hidden
}
.foto-area{
  width:100%;height:260px;background:#e5e7eb;
  border-radius:14px;display:flex;
  align-items:center;justify-content:center;
  font-weight:700;color:#6b7280;
  cursor:pointer;position:relative;overflow:hidden
}
.foto-area img{position:absolute;touch-action:none}

.legenda{
  height:80px;display:flex;align-items:center;
  justify-content:center;text-align:center;
  font-size:20px;font-weight:600;color:#111;
  word-break:break-word
}

/* EMOJI */
.emoji{
  position:absolute;
  font-size:32px;
  user-select:none;
  touch-action:none;
  cursor:grab;
}

/* WATERMARK */
.watermark{position:absolute;inset:0;pointer-events:none;opacity:.15}
.watermark span{
  position:absolute;font-size:12px;font-weight:800;
  color:var(--secondary);transform:rotate(-30deg)
}

/* CONTROLES */
.controls{display:grid;gap:12px}
.controls input,.controls select,.controls button{
  width:100%;padding:13px;border-radius:16px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.12);
  color:#fff;font-weight:700
}
.controls button.primary{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  border:none;font-weight:900
}

/* EMOJI PICKER */
.emoji-picker{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:8px;
  background:rgba(0,0,0,.45);
  border-radius:18px;
  padding:12px;
}
.emoji-picker span{
  font-size:26px;
  text-align:center;
  cursor:pointer;
}

/* GALERIA */
.galeria h3{margin:0 0 12px;font-weight:900}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px}
.item{background:rgba(0,0,0,.35);border-radius:16px;padding:8px;position:relative}
.item img{width:100%;border-radius:12px}
.item button{
  position:absolute;top:6px;right:6px;
  width:26px;height:26px;border-radius:50%;
  border:none;background:#ef4444;color:#fff
}






.rain-particle{
  background: color-mix(
    in srgb,
    var(--primary) 80%,
    transparent
  );

  box-shadow:
    0 0 6px var(--primary),
    0 0 18px color-mix(in srgb, var(--secondary), transparent 40%);
}





/* ===== SELECT (lista aberta) ===== */
select{
  color: #fff; /* texto quando fechado */
  background: rgba(255,255,255,.12);
}

/* üî• COR DO CARD / DROPDOWN */
select option{
  color: #000 !important;      /* TEXTO PRETO */
  background: #ffffff !important; /* FUNDO BRANCO */
  font-weight: 600;
}




      

</style>
</head>

<body>

<div class="stars" id="stars"></div>

<div class="page">
<div class="layout">

<div class="editor">

  <div class="polaroid" id="polaroid">
    <div class="foto-area" id="fotoArea" onclick="fileInput.click()">üì∏ Toque para adicionar foto</div>
    <div class="legenda" id="legenda"></div>
    <div class="watermark" id="watermark"></div>
  </div>

  <div class="controls">
    <input type="file" id="fileInput" hidden accept="image/*" onchange="carregarFoto(event)">
    <input type="range" min="1" max="3" step="0.1" value="1" onchange="setZoom(this.value)">
    <input type="text" placeholder="Texto do polaroid" oninput="legenda.innerText=this.value">
    <input type="color" onchange="legenda.style.color=this.value">
    <select onchange="legenda.style.fontFamily=this.value">
      <option value="Inter">Inter</option>
      <option value="Pacifico">Pacifico</option>
      <option value="Montserrat">Montserrat</option>
    </select>

    <button onclick="toggleEmojiPicker()">üòÄ Adicionar emoji</button>

    <div class="emoji-picker" id="emojiPicker" style="display:none">
      <span>üòÄ</span><span>üòç</span><span>ü•∞</span><span>üòé</span><span>‚ú®</span><span>‚≠ê</span>
      <span>üéâ</span><span>üéÇ</span><span>üíñ</span><span>üì∏</span><span>üåà</span><span>ü§ç</span>
    </div>

    <button class="primary" onclick="salvar()">Salvar Polaroid</button>
  </div>

</div>

<div class="galeria">
  <h3>Seus Polaroids</h3>
  <div class="grid" id="grid"></div>
</div>

</div>
</div>

<script>


const sb = supabase.createClient(
  "https://egxjgmzukjyyxmkukwub.supabase.co",
  "sb_publishable_EWwdrLOUk6KDHZGLuh4uRg_QDRtLeFi"
);

const lojaId =
  new URLSearchParams(location.search).get("l");
async function carregarTemaLoja(){
  if(!lojaId) return;

  const { data } = await sb
    .from("loja_config")
    .select(`
      primary_color,
      secondary_color,
      background_color,
      text_color,
      border_color
    `)
    .eq("user_id", lojaId)
    .maybeSingle();

  document.documentElement.style.setProperty(
    "--primary",
    data?.primary_color || "#ff6a00"
  );

  document.documentElement.style.setProperty(
    "--secondary",
    data?.secondary_color || data?.primary_color || "#ff9a57"
  );

  document.documentElement.style.setProperty(
    "--text",
    data?.text_color || "#ffffff"
  );

  document.documentElement.style.setProperty(
    "--border",
    data?.border_color || "rgba(255,255,255,.18)"
  );
}

/* CORES + ESTRELAS */
function criarEstrelas(){
  const s=document.getElementById("stars");
  for(let i=0;i<140;i++){
    const e=document.createElement("div");
    e.className="star";
    const size=1+Math.random()*2;
    e.style.width=size+"px";
    e.style.height=size+"px";
    e.style.left=Math.random()*100+"%";
    e.style.opacity=0.4+Math.random()*0.6;
    e.style.animationDuration=(6+Math.random()*10)+"s";
    s.appendChild(e);
      
  }
}
(async ()=>{
  await carregarTemaLoja();
  criarEstrelas();
})();
let foto = null;
let fotoScale = 1;
let fotoX = 0;
let fotoY = 0;

function carregarFoto(e){
  const f = e.target.files[0];
  if(!f) return;

  const img = document.createElement("img");
  img.src = URL.createObjectURL(f);

  img.onload = () => {
    fotoArea.innerHTML = "";
    fotoArea.appendChild(img);

    foto = img;
    fotoScale = 1;
    fotoX = 0;
    fotoY = 0;

    img.style.width = "100%";
    img.style.height = "auto";
    img.style.transformOrigin = "center center";

    aplicarTransformFoto();
    dragFoto(img, fotoArea);
  };
}


function setZoom(valor){
  if(!foto) return;
  fotoScale = parseFloat(valor);
  aplicarTransformFoto();
}

/* EMOJIS */
function toggleEmojiPicker(){
  emojiPicker.style.display =
    emojiPicker.style.display==="none"?"grid":"none";
}
emojiPicker.onclick=e=>{
  if(!e.target.innerText) return;
  criarEmoji(e.target.innerText);
};
function criarEmoji(char){
  const e=document.createElement("div");
  e.className="emoji";
  e.innerText=char;
  e.style.left="50%";
  e.style.top="50%";
  polaroid.appendChild(e);
  gestosEmoji(e);
}

/* GESTOS */
function gestosEmoji(el){
  let size=32;
  el.addEventListener("pointerdown",e=>{
    el.setPointerCapture(e.pointerId);
    el.dataset.x=e.clientX-el.offsetLeft;
    el.dataset.y=e.clientY-el.offsetTop;
  });
  el.addEventListener("pointermove",e=>{
    if(!el.hasPointerCapture(e.pointerId)) return;
    el.style.left=e.clientX-el.dataset.x+"px";
    el.style.top=e.clientY-el.dataset.y+"px";
  });
  el.addEventListener("dblclick",()=>el.remove());
  el.addEventListener("wheel",e=>{
    e.preventDefault();
    size+=e.deltaY<0?2:-2;
    el.style.fontSize=size+"px";
  });
}

/* DRAG GEN√âRICO */
function dragFoto(img, limite){
  let startX = 0, startY = 0;

  img.onpointerdown = e => {
    img.setPointerCapture(e.pointerId);
    startX = e.clientX - fotoX;
    startY = e.clientY - fotoY;
  };

  img.onpointermove = e => {
    if(!img.hasPointerCapture(e.pointerId)) return;
    fotoX = e.clientX - startX;
    fotoY = e.clientY - startY;
    aplicarTransformFoto();
  };

  img.onpointerup = () => {};
}
let pinchStartDist = 0;
let pinchStartScale = 1;

fotoArea.addEventListener("touchstart", e => {
  if(e.touches.length === 2 && foto){
    pinchStartDist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    pinchStartScale = fotoScale;
  }
},{passive:false});

fotoArea.addEventListener("touchmove", e => {
  if(e.touches.length === 2 && foto){
    e.preventDefault();
    const dist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    fotoScale = Math.min(3, Math.max(1, pinchStartScale * (dist / pinchStartDist)));
    aplicarTransformFoto();
  }
},{passive:false});


/* SALVAR */
function salvar(){
  html2canvas(polaroid).then(c=>{
    const img=c.toDataURL("image/png");
    const lista=JSON.parse(localStorage.getItem("polaroids")||"[]");
    lista.push(img);
    localStorage.setItem("polaroids",JSON.stringify(lista));
    limpar();render();
  });
}
function limpar(){
  fotoArea.innerHTML="üì∏ Toque para adicionar foto";
  legenda.innerText="";
  document.querySelectorAll(".emoji").forEach(e=>e.remove());
  foto=null;
}

/* GALERIA */
function excluir(i){
  const lista=JSON.parse(localStorage.getItem("polaroids"));
  lista.splice(i,1);
  localStorage.setItem("polaroids",JSON.stringify(lista));
  render();
}
function render(){
  const lista=JSON.parse(localStorage.getItem("polaroids")||"[]");
  grid.innerHTML=lista.map((i,idx)=>`
    <div class="item">
      <img src="${i}">
      <button onclick="excluir(${idx})">‚úï</button>
    </div>
  `).join("");
}
render();

function aplicarTransformFoto(){
  foto.style.transform =
    `translate(${fotoX}px, ${fotoY}px) scale(${fotoScale})`;
}


















      
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Editar Loja • Agenda Fácil</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Inter;background:#f4f6fb;padding:20px}
.card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px}
label{font-weight:700;font-size:13px}
input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-top:6px}
button{margin-top:14px;padding:14px;border:none;border-radius:999px;background:#ff6a00;color:#fff;font-weight:800}
.toggle{display:flex;align-items:center;gap:8px}
</style>
</head>

<body>

<h2>Visual da Loja</h2>

<div class="card">
  <label>Cor primária</label>
  <input type="color" id="corPrimaria">

  <label>Cor do botão</label>
  <input type="color" id="corBotao">
</div>

<div class="card">
  <div class="toggle">
    <input type="checkbox" id="bannerAtivo">
    <label>Banner ativo</label>
  </div>

  <label>Imagem do banner</label>
  <input id="bannerImagem">

  <label>Texto do banner</label>
  <input id="bannerTexto">
</div>

<div class="card">
  <div class="toggle">
    <input type="checkbox" id="popupAtivo">
    <label>Popup promocional</label>
  </div>

  <label>Título</label>
  <input id="popupTitulo">

  <label>Texto</label>
  <textarea id="popupTexto"></textarea>
</div>

<button onclick="salvar()">Salvar alterações</button>

<script>
const sb = supabase.createClient(
 "https://egxjgmzukjyyxmkukwub.supabase.co",
 "sb_publishable_EWwdrLOUk6KDHZGLuh4uRg_QDRtLeFi"
);

let user;

async function init(){
  const {data:{session}} = await sb.auth.getSession();
  if(!session) location.href="login.html";
  user = session.user;

  const {data} = await sb
    .from("config_loja")
    .select("*")
    .eq("user_id", user.id)
    .single();

  if(data){
    corPrimaria.value = data.cor_primaria;
    corBotao.value = data.cor_botao;
    bannerAtivo.checked = data.banner_ativo;
    bannerImagem.value = data.banner_imagem || "";
    bannerTexto.value = data.banner_texto || "";
    popupAtivo.checked = data.popup_ativo;
    popupTitulo.value = data.popup_titulo || "";
    popupTexto.value = data.popup_texto || "";
  }
}
init();

async function salvar(){
  await sb.from("config_loja").upsert({
    user_id: user.id,
    cor_primaria: corPrimaria.value,
    cor_botao: corBotao.value,
    banner_ativo: bannerAtivo.checked,
    banner_imagem: bannerImagem.value,
    banner_texto: bannerTexto.value,
    popup_ativo: popupAtivo.checked,
    popup_titulo: popupTitulo.value,
    popup_texto: popupTexto.value
  });
  alert("Configurações salvas!");
}
</script>

</body>
</html>
